<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title><%= content_for(:title) || "Blog App" %></title>
    
    <!-- Meta tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Blog App">
    <meta name="mobile-web-app-capable" content="yes">
    
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" 
          rel="stylesheet" 
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" 
          crossorigin="anonymous">
    
    <!-- Your app styles (after Bootstrap so you can override) -->
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    
    <!-- Icons / PWA -->
    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon.png">
    
    <%= yield :head %>
    
    <!-- Bootstrap JS (at end for performance, but you had it in body — moved here) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" 
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" 
            crossorigin="anonymous"></script>
    
    <%= javascript_importmap_tags %>
  </head>

  <body class="bg-light">
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg bg-white shadow-sm border-bottom sticky-top">
      <div class="container-fluid px-4">
        <%= link_to "Blog App", root_path, class: "navbar-brand fw-semibold fs-4 text-primary" %>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" 
                data-bs-target="#navbarMain" aria-controls="navbarMain" 
                aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarMain">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <%= link_to "All Posts", posts_path, class: "nav-link #{ 'active fw-medium' if current_page?(posts_path) }" %>
            </li>
            <!-- Add more nav items here if needed -->
          </ul>

          <ul class="navbar-nav ms-auto align-items-lg-center">
            <% if user_signed_in? %>
              <li class="nav-item">
              <span class="nav-link">
               Hi <%= current_user.first_name || current_user.email %>
               <span class="badge <%= role_badge_class(current_user.role) %> ms-1">
                <%= current_user.role.capitalize %>
              </span>
             </span>
              </li>
              <% if policy(Post.new).create? %>
              <li class="nav-item">
                  <%= link_to "New Post", new_post_path, class: "nav-link" %>
               </li>
               <% end %>
              <li class="nav-item">
                <%= link_to "Profile", edit_user_registration_path, class: "nav-link" %>
              </li>
              <li class="nav-item">
                <%= button_to "Logout", destroy_user_session_path, method: :delete,
                              class: "btn btn-outline-danger btn-sm px-3" %>
              </li>
            <% else %>
              <li class="nav-item">
                <%= link_to "Login", new_user_session_path, class: "nav-link" %>
              </li>
              <li class="nav-item">
                <%= link_to "Sign Up", new_user_registration_path, class: "btn btn-primary btn-sm px-3 ms-2" %>
              </li>
            <% end %>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Flash messages -->
    <div class="container mt-3">
      <% flash.each do |type, message| %>
        <div class="alert alert-<%= type == 'notice' ? 'success' : (type == 'alert' ? 'warning' : 'danger') %> alert-dismissible fade show" role="alert">
          <%= message %>
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      <% end %>
    </div>

    <!-- Main content -->
    <main class="container my-4">
      <%= yield %>
    </main>

    <!-- Optional: simple footer if you want one later -->
   <footer class="bg-white border-top py-4 mt-5 text-center text-muted small">
      © <%= Time.now.year %> Blog App
    </footer> 
  </body>
</html>